<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Quirks of Python | Héctor Climente-González </title> <meta name="author" content="Héctor Climente-González"> <meta name="description" content="A catch-all of interesting behaviors"> <meta name="keywords" content="machine-learning, genetics, pharma, drug-discovery, climente, climente-gonzalez"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%AA%A2&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://hclimente.github.io/blog/python-quirks/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Héctor</span> Climente-González </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Quirks of Python</h1> <p class="post-meta"> Created in February 11, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> python</a>   <a href="/blog/tag/coding"> <i class="fa-solid fa-hashtag fa-sm"></i> coding</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>In this post, I present some interesting features of Python that were not within the scope of the previous posts.</p> <h1 id="strings">Strings</h1> <h2 id="string-formatting">String formatting</h2> <p>While Python offers multiple ways of formatting strings (i.e., combining predefined text and variables), <a href="https://docs.python.org/3/tutorial/inputoutput.html#formatted-string-literals" rel="external nofollow noopener" target="_blank">F-strings</a> are particularly elegant:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">constants</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">pi</span><span class="sh">"</span><span class="p">:</span> <span class="mf">3.14159265358979323846</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">sqrt(2)</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.41421356237309504880</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Euler</span><span class="sh">'</span><span class="s">s number</span><span class="sh">"</span><span class="p">:</span> <span class="mf">2.71828182845904523536</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">constants</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pi = 3.141592653589793
sqrt(2) = 1.4142135623730951
Euler's number = 2.718281828459045
</code></pre></div></div> <p>The float variables can be rounded to a given precision:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">constants</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pi = 3.142
sqrt(2) = 1.414
Euler's number = 2.718
</code></pre></div></div> <p>Values can also be formatted to occupy a minimum fixed width:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">constants</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="mi">10</span><span class="si">}</span><span class="s"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pi         = 3.142
sqrt(2)    = 1.414
Euler's number = 2.718
</code></pre></div></div> <p>Note that the string “Euler’s number” exceeds the minimum length of 10, and is hence represented as is.</p> <h2 id="implicit-string-concatenation">Implicit string concatenation</h2> <p>Strings placed next to each other are automatically concatenated:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">assert</span> <span class="sh">"</span><span class="s">foo</span><span class="sh">"</span> <span class="sh">"</span><span class="s">bar</span><span class="sh">"</span> <span class="o">==</span> <span class="sh">"</span><span class="s">foo</span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="s">bar</span><span class="sh">"</span>
</code></pre></div></div> <p>This is useful to cleanly produce long strings while respecting a certain maximum line length:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">message</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Hello, </span><span class="sh">"</span> \
          <span class="sh">"</span><span class="s">World!</span><span class="sh">"</span>
<span class="nf">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello, World!
</code></pre></div></div> <h1 id="lists">Lists</h1> <h2 id="enumerate-with-an-offset"> <code class="language-plaintext highlighter-rouge">enumerate</code> with an offset</h2> <p>The <a href="https://docs.python.org/3/library/functions.html#enumerate" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">enumerate</code></a> function creates a lazy generator over an iterable that will return a tuple (index, item). It can take a second parameter, to indicate the first index to start counting from:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">]</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>10: a
11: b
12: c
</code></pre></div></div> <h2 id="zip-and-itertoolszip_longest"> <code class="language-plaintext highlighter-rouge">zip</code> and <code class="language-plaintext highlighter-rouge">itertools.zip_longest</code> </h2> <p>The <a href="https://docs.python.org/3/library/functions.html#zip" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">zip</code></a> function combines two or more iterators, generating a lazy generator which yields the next item from each. It is particularly useful to handle related lists that have the same length:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">squared</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">]</span>

<span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">square</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">squared</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">The square of </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s"> is </span><span class="si">{</span><span class="n">square</span><span class="si">}</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The square of 1 is 1.
The square of 2 is 4.
The square of 3 is 9.
</code></pre></div></div> <p>However, when the two iterables have different lenghts, <code class="language-plaintext highlighter-rouge">zip</code> will only emit as many elements as the shortest of them:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xs</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ys</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 0
1 1
2 2
3 3
</code></pre></div></div> <p>When we do not wish this truncation to happen, <a href="https://docs.python.org/3/library/itertools.html#itertools.zip_longest" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">itertools.zip_longest</code></a> might be what we need:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">itertools</span> <span class="kn">import</span> <span class="n">zip_longest</span>

<span class="n">xs</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ys</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nf">zip_longest</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 0
1 1
2 2
3 3
None 4
</code></pre></div></div> <h1 id="sorting-by-complex-criteria">Sorting by complex criteria</h1> <p>The <a href="https://docs.python.org/3/library/stdtypes.html#list.sort" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">list.sort</code></a> method orders a list’s elements in ascending order. It will work as long as the items have defined the <code class="language-plaintext highlighter-rouge">&lt;</code> comparison operator, as is the case for floats, integers and strings. However, in some cases that operator might not be implemented, or might not be making the comparison that we care about. The <code class="language-plaintext highlighter-rouge">key</code> argument is helpful in those cases:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Animal</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Animal(</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">weight</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>

<span class="n">animals</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nc">Animal</span><span class="p">(</span><span class="sh">"</span><span class="s">whale</span><span class="sh">"</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span>
    <span class="nc">Animal</span><span class="p">(</span><span class="sh">"</span><span class="s">sea lion</span><span class="sh">"</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
    <span class="nc">Animal</span><span class="p">(</span><span class="sh">"</span><span class="s">lion</span><span class="sh">"</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
    <span class="nc">Animal</span><span class="p">(</span><span class="sh">"</span><span class="s">possum</span><span class="sh">"</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># sort by weight
</span><span class="n">animals</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">weight</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Animal(possum, 2.5), Animal(sea lion, 200), Animal(lion, 200), Animal(whale, 100000)]
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># sort by name
</span><span class="n">animals</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Animal(lion, 200), Animal(possum, 2.5), Animal(sea lion, 200), Animal(whale, 100000)]
</code></pre></div></div> <p>As shown, <code class="language-plaintext highlighter-rouge">key</code> takes a function which will receive an item, and output a comparable value. If we want to order first by weight, then by name, we just need to combine both in a tuple:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># sort by name
</span><span class="n">animals</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Animal(possum, 2.5), Animal(lion, 200), Animal(sea lion, 200), Animal(whale, 100000)]
</code></pre></div></div> <h1 id="the-walrus-operator">The walrus operator</h1> <p>The <a href="https://docs.python.org/3/reference/expressions.html#assignment-expressions" rel="external nofollow noopener" target="_blank">walrus operator</a> (<code class="language-plaintext highlighter-rouge">:=</code>) allows to assign variables in the middle of expressions:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">is_divisor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Check if y is a divisor of x.

    Parameters:
    - x (int): The dividend.
    - y (int): The potential divisor.

    Returns:
    tuple: A tuple containing a boolean indicating whether y is a divisor of x,
           and the remainder when x is divided by y. If y is a divisor, the
           boolean is True, and the remainder is 0; otherwise, the boolean is
           False, and the remainder is the result of x % y.
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="n">remainder</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="n">remainder</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">is_divisor</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(True, 0)
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="nf">is_divisor</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(False, 1)
</code></pre></div></div> <p>The walrus operator is present in the first line of the <code class="language-plaintext highlighter-rouge">is_divisor</code> function. It allows two things to happen at once. First, the <code class="language-plaintext highlighter-rouge">if</code> clause will evaluate the expression <code class="language-plaintext highlighter-rouge">x % y</code> (false if the remainder is 0; true if it’s any other number). Additionally, it is setting the <code class="language-plaintext highlighter-rouge">remainder</code> variable to <code class="language-plaintext highlighter-rouge">x % y</code>. This makes the code easier to understand, since <code class="language-plaintext highlighter-rouge">remainder</code> is only defined if it is going to be used.</p> <h1 id="floats-and-integers">Floats and integers</h1> <h2 id="underscores-as-visual-separators">Underscores as visual separators</h2> <p>We can use underscores <code class="language-plaintext highlighter-rouge">_</code> as visual separators between any pair of digits in integers, floats or complex numbers:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">assert</span> <span class="mi">10_000_000</span> <span class="o">==</span> <span class="mi">10000000</span>
<span class="k">assert</span> <span class="mf">1_100.3</span> <span class="o">==</span> <span class="mf">1100.3</span>
</code></pre></div></div> <p>I find this particularly useful when dealing with large numbers.</p> <h2 id="limitations-of-floating-point-arithmetic">Limitations of floating point arithmetic</h2> <p>Most decimal floating-point numbers cannot be represented as binary floating-point numbers. Instead, computers just store an approximation. This behavior is not evident by just asking Python to display a number, since it will round it:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.1
</code></pre></div></div> <p>However, if we request Python to give more significant digits:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">format</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="sh">'</span><span class="s">.20g</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'0.10000000000000000555'
</code></pre></div></div> <p>While this approximation is smaller than \(2^(-53)\), that is enough to cause errors:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">assert</span> <span class="p">.</span><span class="mi">1</span> <span class="o">+</span> <span class="p">.</span><span class="mi">2</span> <span class="o">==</span> <span class="p">.</span><span class="mi">3</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AssertionError
</code></pre></div></div> <p>Luckily, we can get around it with a little extra work:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">math</span>

<span class="k">assert</span> <span class="n">math</span><span class="p">.</span><span class="nf">isclose</span><span class="p">(.</span><span class="mi">1</span> <span class="o">+</span> <span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="p">.</span><span class="mi">3</span><span class="p">)</span>

<span class="k">assert</span> <span class="nf">round</span><span class="p">(.</span><span class="mi">1</span> <span class="o">+</span> <span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nf">round</span><span class="p">(.</span><span class="mi">3</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div> <h1 id="generators">Generators</h1> <p>TODO</p> <h1 id="typing-hints">Typing hints</h1> <p>In this series, we have seen multiple examples in which the type of a variable is specified. For instance:</p> <ul> <li>Variables:</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</code></pre></div></div> <ul> <li>Function arguments and return values:</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s">: </span><span class="sh">"</span> <span class="k">if</span> <span class="n">prefix</span> <span class="k">else</span> <span class="sh">""</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">x</span><span class="p">.</span><span class="nf">title</span><span class="p">()</span><span class="si">}</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Note that typing hints are a relatively recent addition to Python. Typing hints of recent verions of Python might produce parsing errors on older version.</p> <p>The stdlib’s <a href="https://docs.python.org/3/library/typing.html" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">typing</code></a> module gives many options to control type hints. (Widely used packages bring their own typing hints, like <a href="https://numpy.org/devdocs/reference/typing.html" rel="external nofollow noopener" target="_blank">numpy</a>.) Below I explore some interesting features.</p> <h2 id="overloading-functions">Overloading functions</h2> <p>The decorator <code class="language-plaintext highlighter-rouge">@typing.overload</code> allows to overload functions, that is, have a function behave differently depending on the argument type.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">overload</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="bp">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="bp">...</span>

<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">square</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span> <span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
</code></pre></div></div> <h2 id="type-checking">Type checking</h2> <p>Python is a dynamically typed language. Hence, typing hints are just, that, hints. However, we can use <a href="https://github.com/python/mypy" rel="external nofollow noopener" target="_blank">mypy</a> on our entire codebase to check that types are used correctly.</p> <h1 id="bitwise-operations">Bitwise operations</h1> <h2 id="for-integer-arithmetic">For integer arithmetic</h2> <p>Some people are really concerned by performance. Their concern is such that they are willing to sacrifice code readability for minor gains in performance. Such people might get satisfaction from replacing arithmetic operations involving integers by bitwise operations. Since those act directly on the bit representation of the integer, they can be more efficient. Despite compilers performing some optimization of their own, <a href="https://stackoverflow.com/questions/37053379/times-two-faster-than-bit-shift-for-python-3-x-integers" rel="external nofollow noopener" target="_blank">there is some somewhat old evidence supporting that bitwise operations are faster.</a> I describe below some common optimizations.</p> <h3 id="dividing-and-multiplying-by-powers-of-two">Dividing and multiplying by powers of two</h3> <p>The <code class="language-plaintext highlighter-rouge">&gt;&gt;</code> and the <code class="language-plaintext highlighter-rouge">&lt;&lt;</code> operators shift the bit representation to the left and to the right, respectively. This can be used to quickly divide or multiply integers by powers of two:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="mb">0b101</span> <span class="c1"># 5
</span>
<span class="c1"># shift to the right by 1
#   0b101 &gt;&gt; 0b10
# equivalent to 5 // 2**1
</span><span class="mi">5</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span> <span class="c1"># 2
</span>
<span class="c1"># shift to the left by 4
#   0b101 &gt;&gt; 0b1010000
# 5 * 2**4
</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span> <span class="c1"># 80
</span></code></pre></div></div> <h3 id="check-if-a-number-is-odd">Check if a number is odd</h3> <p>The <code class="language-plaintext highlighter-rouge">&amp;</code> operator is the bitwise AND operator. When we use <code class="language-plaintext highlighter-rouge">&amp;</code> between any integer and a 1, we are effectively cheching if the last bit is a 1 (odd) or a 0 (even):</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 0b1110 &amp; 0b0001 = 0b0000 = 0
</span><span class="k">assert</span> <span class="ow">not</span> <span class="mi">14</span> <span class="o">&amp;</span> <span class="mi">1</span>

<span class="c1"># 0b1111 &amp; 0b0001 = 0b0001 = 1
</span><span class="k">assert</span> <span class="mi">15</span> <span class="o">&amp;</span> <span class="mi">1</span>
</code></pre></div></div> <h2 id="iterate-a-list-from-the-end">Iterate a list from the end</h2> <p>The <code class="language-plaintext highlighter-rouge">~</code> operator is the complement operator, which switches 1s by 0s and vice versa. Let’s see it in action:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 0b01 -&gt; 0b10
</span><span class="k">assert</span> <span class="o">~</span><span class="mi">1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span>
<span class="k">assert</span> <span class="o">~-</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">3</span>
</code></pre></div></div> <p>Since the first bit represents the sign, it has the effect of turning \(x\) into \(-x - 1\). This is useful when we need to simultaneously iterate the front and the back of a list:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">is_palindrome</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">all</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">word</span><span class="p">[</span><span class="o">~</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)])</span>

<span class="k">assert</span> <span class="nf">is_palindrome</span><span class="p">(</span><span class="sh">"</span><span class="s">kayak</span><span class="sh">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="nf">is_palindrome</span><span class="p">(</span><span class="sh">"</span><span class="s">dog</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <h1 id="exceptions">Exceptions</h1> <p>Handling exceptions with <code class="language-plaintext highlighter-rouge">try: ... except: ...</code> is a common in Python code. But there are some additional nuances:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">y</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{}[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># we can handle multiple, specific exceptions
</span><span class="k">except</span> <span class="nb">TypeError</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Can</span><span class="sh">'</span><span class="s">t sum an integer and a </span><span class="si">{</span><span class="nf">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">AttributeError</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Can</span><span class="sh">'</span><span class="s">t append to </span><span class="si">{</span><span class="nf">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># we can still add a catch-all exception
</span><span class="k">except</span><span class="p">:</span>
    <span class="c1"># we can throw our own exception
</span>    <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sh">"</span><span class="s">Something went wrong.</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># behavior if no error is raised
</span><span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">All good.</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># a block that will be run no matter what,
# usually good for clean up
</span><span class="k">finally</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Thanks anyway.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <h1 id="context-managers">Context managers</h1> <p>A context manager is a programming construct that makes it easy to allocate and release resources. It is useful to handle file operations, network connections or database transactions, when it is important to release the resource when we are done with it. They can be used using the <code class="language-plaintext highlighter-rouge">with</code> statement. The context manager class needs two methods: <code class="language-plaintext highlighter-rouge">__enter__</code>, to setup the resource, and <code class="language-plaintext highlighter-rouge">__exit__</code>, to clean up and release the resource.</p> <h1 id="references">References</h1> <ul> <li>D. Beazley, <a href="https://github.com/dabeaz-course/python-mastery" rel="external nofollow noopener" target="_blank">Advanced Python Mastery</a> </li> <li>B. Slatkin, Effective Python: 90 Specific Ways to Write Better Python.</li> <li><a href="https://peps.python.org/pep-0515/" rel="external nofollow noopener" target="_blank">PEP 515 – Underscores in Numeric Literals</a></li> </ul> </div> </article> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>
      let giscusTheme = determineComputedTheme();
      let giscusAttributes = {
        src: 'https://giscus.app/client.js',
        'data-repo': 'hclimente/hclimente.github.io',
        'data-repo-id': '',
        'data-category': 'Comments',
        'data-category-id': '',
        'data-mapping': 'title',
        'data-strict': '1',
        'data-reactions-enabled': '1',
        'data-emit-metadata': '0',
        'data-input-position': 'bottom',
        'data-theme': giscusTheme,
        'data-lang': 'en',
        crossorigin: 'anonymous',
        async: '',
      };

      let giscusScript = document.createElement('script');
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById('giscus_thread').appendChild(giscusScript);
    </script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Héctor Climente-González. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>