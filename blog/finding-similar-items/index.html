<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Finding similar documents | Héctor Climente-González </title> <meta name="author" content="Héctor Climente-González"> <meta name="description" content="A fast algorithm to quickly scan over the corpus"> <meta name="keywords" content="machine-learning, genetics, pharma, drug-discovery, climente, climente-gonzalez"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%AA%A2&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://hclimente.github.io/blog/finding-similar-items/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Héctor</span> Climente-González </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Finding similar documents</h1> <p class="post-meta"> Created on November 04, 2017 </p> <p class="post-tags"> <a href="/blog/2017"> <i class="fa-solid fa-calendar fa-sm"></i> 2017 </a>   ·   <a href="/blog/tag/local-sensitivity-hashing"> <i class="fa-solid fa-hashtag fa-sm"></i> local-sensitivity-hashing</a>   <a href="/blog/tag/document-similarity"> <i class="fa-solid fa-hashtag fa-sm"></i> document-similarity</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>⚠️ See <a href="/blog/rags/">the post on RAGs</a> for an updated take on this problem.</p> </blockquote> <p>Here we address the problem of looking for similar, but not necessarily equal items. This is frequently the case of looking for related documents. For example, all the versions of the same news article: they all possibly come from the same source, each website makes slight modifications.</p> <h1 id="distance-measures">Distance measures</h1> <p>If we wanted to find equal documents, finding an efficient solution would be relatively straightforward: hash them and see which ones fall in the same bucket. In this case, we have to define a similarity measure or, analogously, a distance metric, which takes small values when the two items are alike. Many metrics for different kinds of data have been defined.</p> <h2 id="jaccard-distance">Jaccard distance</h2> <p>The Jaccard similarity between two sets \(A\) and \(B\) is defined by looking at the relative size of their intersection:</p> \[J(S,T)=\frac{|S\cap T|}{|S \cup T|}.\] <p>Equivalently, the Jaccard distance is defined as \(1-J(S,T)\).</p> <h2 id="cosine-distance">Cosine distance</h2> <p>Cosine distance is used in spaces that have dimensions, and hence we can think of points as non-zero vectors. In this case, the distance between two vectors \(x\) and \(y\) would be the angle between them, which independently of how many dimensions are there, will be between 0 and 180 degrees.</p> <h2 id="edit-distance">Edit distance</h2> <p>Edit distance can be used when points are strings. The distance between two strings \(x\) and \(y\) will be the smallest number of single-character insertions and deletions that would convert \(x\) into \(y\). It can be easily computed from the <em>longest common subsequence</em>.</p> <h1 id="efficiently-finding-similar-items">Efficiently finding similar items</h1> <p>In this problem, we will start from \(N\) items (documents, images, etc.) which we represent in a \(D\)-dimensional space. An exhaustive approach is calculating all pairwise distances, but that would be very inefficient (\(O(N^2)\)). Instead, we will study an approximate methods, that produces a good enough estimation of similarity in a reasonable time. The process is divided in:</p> <ol> <li>Shingling: convert documents into vectors/sets.</li> <li>Minhashing: convert sets to signatures.</li> <li>Locality-sensitive hashing: make an estimation of the similarity.</li> </ol> <h2 id="shingling">Shingling</h2> <p>The first step is representing the documents as sets. A \(k\)-shingle of a document is the set of any substring of length \(k\) that appears in the document. Or, instead of directly using substrings as shingles, we can apply a hash function that maps strings of length \(k\) to a number of buckets, representing the data more compactly while conserving most of the information. This is possible because many of the possible shingles might never appear i.e. we are mapping documents to a mostly-empty space. So it’s possible to map every shingle the lower dimensionality space represented by the buckets.</p> <p>The choice of \(k\) is not trivial, and mostly depends on how long are usually the documents we are dealing with. Hence, \(k\) must be chosen so that the probability of any given shingle appearing in any given document is low: the longer the average document, the higher the \(k\) of choice.</p> <p>There are two kind of special elements in the text that must be dealt with: white spaces - tabs, spaces… - and <em>stop words</em> - the most common words. Stop words are specially interesting because, while usually are just ignored, in some instances they have been used for improved classification.</p> <p>(Sets contain unique, unordered elements; multisets or bags are generalisations of sets which may contain several instances of the same element.)</p> <h2 id="minhashing">Minhashing</h2> <p>In the exhaustive approach, we could already take the shingle-sets and calculate the Jaccard index between all pairs, still a problem with \(O(N^2)\) complexity. Additionally, shingle-sets are large. For example, shingle-set hashed to 4 byte-buckets still occupies 4 times more than the original document. So we will convert the sets to small signatures that preserve the similarity information i.e. if two documents are similar, they will tend to have the same output in the hash functions.</p> <p>We will do so through a process called minhashing. To understand it, we can imagine all our shingle-sets represented it as a characteristic matrix \(C\), although our data most probably won’t be represented like that. Each column \(c\) of \(C\) is one document; each row \(r\) represents one element of the all the possible shingles; and an element \(C_{r,c}\) will take a value of 1 if the element for row \(r\) is a member of the set for \(c\) and 0 otherwise. In the minhash procedure, we will create a minhash signature matrix \(M\) by repeating the following steps \(n\) times:</p> <ol> <li>Generate a random permutation of the rows of \(C\).</li> <li>For each column \(c\)/document: <ol> <li>Get the first row \(k\) that has a 1.</li> <li>Fill the column \(c\) of the signature matrix M with \(k\).</li> </ol> </li> </ol> <p>We build a new representation of our set \(S\) as a vector \([h_1(S), h_2(S), ..., h_n(S)]\). This is the only representation we will use to study similarity. Minhashing exploits an interesting property: the probability that permutation \(i\) of two sets \(S\) and \(T\) produce \(h_i(S) = h_i(T)\) equals the Jaccard similarity of these two sets. This allows us to estimate the Jaccard similarity from \(M\).</p> <p>In practice, permuting a huge matrix is very time consuming, and it is not feasible in real-world applications. Instead, \(n\) hash functions \(h_i\) are selected, which are applied on the row number. In some cases, two rows might end up in the same bucket. But still, in most of the cases that will not happen, so this is a good approach to random permutations.</p> <h2 id="locality-sensitive-hashing">Locality-sensitive hashing</h2> <p>We calculate \(M\), which has a complexity of \(N\). We will pick the documents that are similar enough on the M matrix as candidates to similar documents. Then, we will compute exactly the Jaccard similarity between the candidates.</p> <p>We do that by binning the rows into bands, and the compare the documents inside each band. We will get how many bands are exactly the same between two documents.</p> <p>Depending on the choice of \(r\) and \(t\), we modulate the curve. Hence we get to the sensitivity of our curve.</p> <h1 id="references">References</h1> <ul> <li>Leskovec, J., Rajaraman, A., &amp; Ullman, J. D. (2014). Mining of Massive Datasets (3rd ed.). Cambridge University Press. Retrieved from http://i.stanford.edu/~ullman/mmdsn.html</li> </ul> </div> </article> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <br> <script defer src="/assets/js/giscus-setup.js"></script> <noscript> Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Héctor Climente-González. All content and views expressed here are strictly personal and do not reflect the opinions, policies, or practices of my current or former employer. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>