<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> An intro to uv | Héctor Climente-González </title> <meta name="author" content="Héctor Climente-González"> <meta name="description" content="A Swiss Army Knife for Python data science"> <meta name="keywords" content="machine-learning, genetics, pharma, drug-discovery, climente, climente-gonzalez"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%AA%A2&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://hclimente.github.io/blog/python-uv/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Héctor</span> Climente-González </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">An intro to uv</h1> <p class="post-meta"> Created on April 25, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> python</a>   <a href="/blog/tag/coding"> <i class="fa-solid fa-hashtag fa-sm"></i> coding</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Python veterans will be familiar with <code class="language-plaintext highlighter-rouge">pip</code>, <code class="language-plaintext highlighter-rouge">poetry</code>, <code class="language-plaintext highlighter-rouge">pyenv</code>, <code class="language-plaintext highlighter-rouge">conda</code> and a few other tools for managing projects, packages and environments. <a href="https://github.com/astral-sh/uv" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">uv</code></a>’s goal is to replace them all while being blazingly fast.</p> <p>We will use <code class="language-plaintext highlighter-rouge">uv</code> for a prototypical machine learning project: train a neural network to classify images of handwritten digits from the <a href="https://en.wikipedia.org/wiki/MNIST_database" rel="external nofollow noopener" target="_blank">MNIST dataset</a> using a <a href="https://en.wikipedia.org/wiki/Convolutional_neural_network" rel="external nofollow noopener" target="_blank">convolutional neural network</a>. The input of the model will be a 28x28 pixel image, and the output will be a vector of 10 probabilities, one for each digit. If you are interested in the details of the model, you can check out the <a href="https://github.com/hclimente/hclimente.github.io/tree/main/assets/python/2025-03-15-python-uv/mnist-classifier" rel="external nofollow noopener" target="_blank">code</a>.</p> <div style="width:50%; margin:0 auto;"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/python/2025-03-15-python-uv/mnist-classifier/img/mnist_examples.webp" sizes="95vw"></source> <img src="/assets/python/2025-03-15-python-uv/mnist-classifier/img/mnist_examples.webp" class="img-fluid rounded z-depth-1" width="100%" height="auto" alt="Sample MNIST digits" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> A few examples from MNIST </div> <p>My previous workflow relied on <code class="language-plaintext highlighter-rouge">conda</code> to handle the project environment. I’d start by creating a new conda environment and installing several packages via slow <code class="language-plaintext highlighter-rouge">conda install</code> commands before getting to work. If during model development I needed additional packages, I’d run another <code class="language-plaintext highlighter-rouge">conda install</code> hoping to avoid the dreaded <code class="language-plaintext highlighter-rouge">Solving environment: failed with initial frozen solve. Retrying with flexible solve.</code> error. Once I’d finish, I’d dump my environment into an <code class="language-plaintext highlighter-rouge">environment.yaml</code>, strip-out dev-only dependencies, and hope that the final environment sufficiently resembles the one I worked on. Finally, I’d package the model into a Docker image to get it ready for production.</p> <p>Clearly, I wasn’t thrilled with my old workflow. Let’s see how <code class="language-plaintext highlighter-rouge">uv</code> made it a more pleasant experience.</p> <h1 id="why-uv">Why <code class="language-plaintext highlighter-rouge">uv</code>?</h1> <p>Before diving into the details, it’s worth justifying why we need <em>yet another tool</em> for managing Python-centric data science projects.</p> <p>First, <code class="language-plaintext highlighter-rouge">uv</code> is <strong>fast</strong>. As is common in new high-performance tools, it’s written in Rust, a compiled language known for its performance. It also uses different strategies to speed up package installation, like caching and parallelization. Anyone who has installed a package with <code class="language-plaintext highlighter-rouge">conda</code> knows that package resolution can be a pretty painful experience.</p> <p>Second, <code class="language-plaintext highlighter-rouge">uv</code> boosts <strong>reproducibility</strong>. As we will see below, it makes it easy to create and share virtual environments. This is key to ensure that multiple developers can work on a consistent environment. Furthermore, it facilitates moving projects from development to production.</p> <p>Third, <code class="language-plaintext highlighter-rouge">uv</code> leverages <strong>common standards</strong> within the Python ecosystem. This reduces the risk of being locked into its ecosystem, and makes it easy to collaborate with other developers that use different tools.</p> <p>Last, <code class="language-plaintext highlighter-rouge">uv</code> is <strong>one</strong> tool, which means that I don’t need to remember the syntax of multiple tools, or how to use them together.</p> <details><summary>Why <em>not</em> <code class="language-plaintext highlighter-rouge">uv</code>?</summary> <p>I’m always quite enthusiastic about the new, shinier tool. But before jumping straight into <code class="language-plaintext highlighter-rouge">uv</code>, it’s worth considering the downsides of adopting it.</p> <p>First, <code class="language-plaintext highlighter-rouge">uv</code> is <strong>young</strong>. In contrast, tools like <code class="language-plaintext highlighter-rouge">pip</code>, <code class="language-plaintext highlighter-rouge">conda</code> or <code class="language-plaintext highlighter-rouge">venv</code> have been around for more than a decade. I have no doubt they will be around for at least another decade and are unlikely to pull the rug from under me with breaking changes.</p> <p>Second, and on a related note, <code class="language-plaintext highlighter-rouge">uv</code> is <strong>not widely adopted</strong>. This means that I have had a hard time troubleshooting some errors. It has also meant that it’s not a standard, and you might need to be prepared to advocate for it in your team.</p> <p>Last, <code class="language-plaintext highlighter-rouge">uv</code> is mainly developed by <a href="https://astral.sh" rel="external nofollow noopener" target="_blank">Astral</a>, a VC-backed startup that hasn’t started monetizing their products yet. It remains to be seen how their future business model will impact their tools. I should highlight that <code class="language-plaintext highlighter-rouge">uv</code> is open-source and licensed under MIT, which is somewhat reassuring.</p> <p>I believe that it’s a worthwhile trade-off. But, you know, <em>caveat emptor</em>.</p> </details> <h1 id="starting-a-new-project">Starting a new project</h1> <p>After <a href="https://docs.astral.sh/uv/getting-started/installation/" rel="external nofollow noopener" target="_blank">installing <code class="language-plaintext highlighter-rouge">uv</code></a>, we simply need to run <code class="language-plaintext highlighter-rouge">uv init</code> to start a new project:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uv init mnist-classifier
</code></pre></div></div> <p>This creates a directory <code class="language-plaintext highlighter-rouge">mnist-classifier</code> in the current directory containing a few files we’ll soon dig into. One of them is a <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">pyproject.toml</code></a> file that stores the project’s metadata and configuration. This is a standard file used by <a href="https://python-poetry.org/docs/pyproject/" rel="external nofollow noopener" target="_blank">many</a> <a href="https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/" rel="external nofollow noopener" target="_blank">tools</a> <a href="https://docs.astral.sh/ruff/configuration/" rel="external nofollow noopener" target="_blank">in</a> <a href="https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#command-line-options" rel="external nofollow noopener" target="_blank">the</a> <a href="https://docs.pytest.org/en/stable/reference/customize.html#pyproject-toml" rel="external nofollow noopener" target="_blank">Python</a> <a href="https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html" rel="external nofollow noopener" target="_blank">ecosystem</a>. For instance, <code class="language-plaintext highlighter-rouge">pip install .</code> would install all the packages listed under the <code class="language-plaintext highlighter-rouge">dependencies</code> field. The <code class="language-plaintext highlighter-rouge">pyproject.toml</code> file created by <code class="language-plaintext highlighter-rouge">uv</code> looks like this:</p> <div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[project]</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">"mnist-classifier"</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">"0.1.0"</span>
<span class="py">description</span> <span class="p">=</span> <span class="s">"Add your description here"</span>
<span class="py">readme</span> <span class="p">=</span> <span class="s">"README.md"</span>
<span class="py">requires-python</span> <span class="p">=</span> <span class="py">"&gt;</span><span class="p">=</span><span class="mf">3.10</span><span class="s">"</span><span class="err">
</span><span class="py">dependencies</span> <span class="p">=</span> <span class="p">[]</span>
</code></pre></div></div> <p>Furthermore, it will start a git repository with a sensible <code class="language-plaintext highlighter-rouge">.gitignore</code>.</p> <details><summary>What about <em>package</em> projects?</summary> <p>By default, <code class="language-plaintext highlighter-rouge">uv init</code> creates an <em>application</em> project. This is appropriate for scripts, like simple tools. This is why the command above created a <code class="language-plaintext highlighter-rouge">main.py</code> file, meant to be the entry point of our application. Alternatively, we could create a <em>library</em> project with <code class="language-plaintext highlighter-rouge">uv init --package mnist-classifier-pkg</code>. This would create a new directory <code class="language-plaintext highlighter-rouge">mnist-classifier-pkg</code> and populate it with a standard structure and configuration suitable for a Python library.</p> </details> <h1 id="creating-the-project-environment">Creating the project environment</h1> <p>Multiple Python projects can co-exist on the same machine, each requiring different packages and versions of the same packages. This is facilitated by <em>virtual environments</em>, self-contained directories with their own Python interpreter and installed Python packages. There are multiple solutions to create and manage virtual environments, like <a href="https://docs.python.org/3/library/venv.html" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">venv</code></a>, <a href="https://anaconda.org/anaconda/conda" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">conda</code></a> or <a href="https://python-poetry.org/" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">poetry</code></a>.</p> <p><code class="language-plaintext highlighter-rouge">uv</code> leverages Python’s built-in package to handle virtual environments: <code class="language-plaintext highlighter-rouge">venv</code>. The virtual environment contains its own installation of Python, whose version is specified in <code class="language-plaintext highlighter-rouge">.python-version</code>. <code class="language-plaintext highlighter-rouge">uv init</code> created this file:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3.10
</code></pre></div></div> <p>The virtual environment itself lives in the <code class="language-plaintext highlighter-rouge">.venv</code> directory. When Python runs from within an environment, it uses the packages installed in that environment, and only those packages. Typically we would activate this virtual environment from the terminal with <code class="language-plaintext highlighter-rouge">source .venv/bin/activate</code>. This will append <code class="language-plaintext highlighter-rouge">.venv/bin/</code> to our <code class="language-plaintext highlighter-rouge">PATH</code>, loading the <code class="language-plaintext highlighter-rouge">python</code> located there into our environment. However, this comes with an overhead: we need to remember to activate the environment before running any Python script, and we need to deactivate (<code class="language-plaintext highlighter-rouge">deactivate</code>) it when we are done. This is a source of errors, as we may forget to activate the environment or, worse, forget to deactivate it.</p> <p>That’s why <code class="language-plaintext highlighter-rouge">uv</code> does not require explicitly activating the environment. Instead, we can use <code class="language-plaintext highlighter-rouge">uv run &lt;script&gt;.py</code> to run any Python script or command using the environment’s Python. For instance, <code class="language-plaintext highlighter-rouge">uv init</code> created a short, example script, <code class="language-plaintext highlighter-rouge">main.py</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello from mnist-classifier!</span><span class="sh">"</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div> <p>As stated, we can run it using our default Python, as we are used to (<code class="language-plaintext highlighter-rouge">python main.py</code>), maybe after <code class="language-plaintext highlighter-rouge">source .venv/bin/activate</code>. But we can also run it using <code class="language-plaintext highlighter-rouge">uv run main.py</code>, which will run the script using the environment’s Python interpreter. Besides avoiding loading/unloading virtual environments, <code class="language-plaintext highlighter-rouge">uv run</code> will automatically create the project environment if it does not exist. Similarly, we can run an interactive Python session via <code class="language-plaintext highlighter-rouge">uv run python</code>.</p> <h2 id="installing-the-required-packages">Installing the required packages</h2> <p>Upon its first invocation, <code class="language-plaintext highlighter-rouge">uv run main.py</code> creates a virtual environment. To do this, it examines the (empty) <code class="language-plaintext highlighter-rouge">dependencies</code> list in <code class="language-plaintext highlighter-rouge">pyproject.toml</code> and resolves an (empty) set of packages.</p> <p>To start our little data science project, we’ll need to install the <a href="https://pytorch.org/" rel="external nofollow noopener" target="_blank">PyTorch</a> library. Typically I would have run <code class="language-plaintext highlighter-rouge">conda install conda-forge::pytorch</code>; in <code class="language-plaintext highlighter-rouge">uv</code> we use <code class="language-plaintext highlighter-rouge">uv add torch</code> instead. This installs the most recent version of the package that is compatible with our environment (2.7.0). The whole thing took 9 seconds. For comparison, installing <code class="language-plaintext highlighter-rouge">torch</code> with <code class="language-plaintext highlighter-rouge">conda</code> took 48 seconds. Upon installation, <code class="language-plaintext highlighter-rouge">pyproject.toml</code> gets automatically updated to:</p> <div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">dependencies</span> <span class="p">=</span> <span class="p">[</span>
    <span class="py">"torch&gt;</span><span class="p">=</span><span class="mf">2.7</span><span class="err">.</span><span class="mi">0</span><span class="s">",</span><span class="err">
</span><span class="p">]</span>
</code></pre></div></div> <p>This is great, as it allows us to keep track of the packages that we needed for our project, reducing our overhead down the road as the project matures.</p> <p>However, <code class="language-plaintext highlighter-rouge">torch</code> depends, in turn, on other packages, like <code class="language-plaintext highlighter-rouge">numpy</code>. Note that this is not reflected in <code class="language-plaintext highlighter-rouge">pyproject.toml</code>, which lists only our direct dependencies, not every transitive package. Furthermore, as we install additional packages like <code class="language-plaintext highlighter-rouge">torchvision</code> or <code class="language-plaintext highlighter-rouge">matplotlib</code>, <code class="language-plaintext highlighter-rouge">uv</code> will need to resolve all the dependencies and potential conflicts between the packages. <code class="language-plaintext highlighter-rouge">uv</code> keeps an additional file, the lockfile (<code class="language-plaintext highlighter-rouge">uv.lock</code>) that records the exact state of the environment with all the specific package resolutions. The lockfile is thus considerably more thorough than <code class="language-plaintext highlighter-rouge">pyproject.toml</code>. For instance, after <code class="language-plaintext highlighter-rouge">uv add torch</code> it expanded to 353 lines describing all the specific packages, their versions and the metadata that were installed in the environment. This is a small excerpt of the lockfile:</p> <div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[[package]]</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">"filelock"</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">"3.18.0"</span>
<span class="py">source</span> <span class="o">=</span> <span class="p">{</span> <span class="py">registry</span> <span class="p">=</span> <span class="s">"https://pypi.org/simple"</span> <span class="p">}</span>
<span class="py">sdist</span> <span class="o">=</span> <span class="p">{</span> <span class="py">url</span> <span class="p">=</span> <span class="s">"https://files.pythonhosted.org/packages/0a/10/c23352565a6544bdc5353e0b15fc1c563352101f30e24bf500207a54df9a/filelock-3.18.0.tar.gz"</span><span class="p">,</span> <span class="py">hash</span> <span class="p">=</span> <span class="s">"sha256:adbc88eabb99d2fec8c9c1b229b171f18afa655400173ddc653d5d01501fb9f2"</span><span class="p">,</span> <span class="py">size</span> <span class="p">=</span> <span class="mi">18075</span> <span class="p">}</span>
<span class="py">wheels</span> <span class="p">=</span> <span class="p">[</span>
    <span class="err">{</span> <span class="py">url</span> <span class="p">=</span> <span class="s">"https://files.pythonhosted.org/packages/4d/36/2a115987e2d8c300a974597416d9de88f2444426de9571f4b59b2cca3acc/filelock-3.18.0-py3-none-any.whl"</span><span class="p">,</span> <span class="py">hash</span> <span class="p">=</span> <span class="s">"sha256:c401f4f8377c4464e6db25fff06205fd89bdd83b65eb0488ed1b160f780e21de"</span><span class="p">,</span> <span class="py">size</span> <span class="p">=</span> <span class="mi">16215</span> <span class="err">}</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">uv.lock</code> should be under git control, providing the exact recipe to replicate an environment. This is key, for instance, to ensure that all developers work on a consistent environment. It can also facilitate moving our code to production, as we’ll see <a href="#training--shipping-the-model">below</a>.</p> <blockquote> <p>If needed, <code class="language-plaintext highlighter-rouge">uv.lock</code> can be exported into a <a href="https://pip.pypa.io/en/stable/reference/requirements-file-format/" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">requirements.txt</code></a> file for legacy tools, via <code class="language-plaintext highlighter-rouge">uv export --format=requirements-txt &gt;requirements.txt</code>.</p> </blockquote> <details><summary>Other package management commands</summary> <p>Besides <code class="language-plaintext highlighter-rouge">uv add</code>, there are other commands that can be used to manage packages. For starters, its counterpart <code class="language-plaintext highlighter-rouge">uv remove &lt;package_name&gt;</code> will uninstall <code class="language-plaintext highlighter-rouge">&lt;package_name&gt;</code>. Another command that can trigger package management is <code class="language-plaintext highlighter-rouge">uv run &lt;script&gt;.py</code>. Before running the script, it will ensure that the lockfile is in sync with <code class="language-plaintext highlighter-rouge">pyproject.toml</code> and then ensure that the project environment is in sync with the lockfile.</p> <p>Syncing refers to (un)installing packages in the project environment to match the lockfile. <code class="language-plaintext highlighter-rouge">uv run</code> will do this automatically, as we just saw. But it can also be forced manually with <code class="language-plaintext highlighter-rouge">uv sync</code>.</p> <p>Last, when adding new packages, <code class="language-plaintext highlighter-rouge">uv</code> will tend to be conservative. It will install the most recent version of the package that is compatible with the current environment. To force a specific version, we can use <code class="language-plaintext highlighter-rouge">uv add &lt;package_name&gt;==&lt;version&gt;</code>. For instance, <code class="language-plaintext highlighter-rouge">uv add torch==2.0.1</code> will install version 2.0.1 of <code class="language-plaintext highlighter-rouge">torch</code>, even if a newer version is available. We can request <code class="language-plaintext highlighter-rouge">uv</code> to upgrade all packages if possible with <code class="language-plaintext highlighter-rouge">uv lock --upgrade</code>; or a specific package with <code class="language-plaintext highlighter-rouge">uv lock --upgrade-package &lt;package_name&gt;</code>.</p> <blockquote> <p>To keep compatibility with <code class="language-plaintext highlighter-rouge">pip</code> workflows, <code class="language-plaintext highlighter-rouge">uv</code> also supports <code class="language-plaintext highlighter-rouge">uv pip install &lt;package_name&gt;</code> and <code class="language-plaintext highlighter-rouge">uv pip uninstall &lt;package_name&gt;</code>. These will (un)install the package in the current environment, but it will not update <code class="language-plaintext highlighter-rouge">pyproject.toml</code> or <code class="language-plaintext highlighter-rouge">uv.lock</code>. For this reason, they should be avoided in favor of <code class="language-plaintext highlighter-rouge">uv add</code> and <code class="language-plaintext highlighter-rouge">uv remove</code>.</p> </blockquote> </details> <h2 id="installing-development-only-dependencies">Installing development-only dependencies</h2> <p>As a data scientist, Jupyter notebooks are my bread and butter. In order to run Jupyter notebooks on our <code class="language-plaintext highlighter-rouge">uv</code> environment, we need to install the <a href="https://pypi.org/project/ipykernel/" rel="external nofollow noopener" target="_blank">IPython kernel <code class="language-plaintext highlighter-rouge">ipykernel</code></a>. However, <code class="language-plaintext highlighter-rouge">ipykernel</code>’s role is different from other packages: it is not a dependency of our code, but a tool needed for development. Once my code is ready, I will distribute it as a standalone Python script that has no dependencies on <code class="language-plaintext highlighter-rouge">ipykernel</code>. The same principle applies to tools like <code class="language-plaintext highlighter-rouge">pytest</code>, used to test your code, but which the end-user shouldn’t require unless they intend to contribute to the project.</p> <p><code class="language-plaintext highlighter-rouge">uv</code> allows you to add development dependencies with <code class="language-plaintext highlighter-rouge">uv add --dev ipykernel</code>, which will add the following to <code class="language-plaintext highlighter-rouge">pyproject.toml</code>:</p> <div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[dependency-groups]</span>
<span class="py">dev</span> <span class="p">=</span> <span class="p">[</span>
    <span class="py">"ipykernel&gt;</span><span class="p">=</span><span class="mf">6.29</span><span class="err">.</span><span class="mi">5</span><span class="s">",</span><span class="err">
</span><span class="p">]</span>
</code></pre></div></div> <p>This should allow my tool of choice, Visual Studio Code, to find this virtual environment and run Jupyter notebooks on it. However, in my experience, it has been somewhat unreliable: Visual Studio Code only finds the kernel half of the time. A workaround is launching a JupyterLab server instance with <code class="language-plaintext highlighter-rouge">uv run --with jupyter jupyter lab</code> and connecting to it from the editor.</p> <h1 id="training--shipping-the-model">(Training &amp;) Shipping the model</h1> <p>Here comes the actual data science, which I will just skim over. I wrote a simple script to train a convolutional neural network on the MNIST dataset. The script is located in <a href="https://github.com/hclimente/hclimente.github.io/tree/main/assets/python/2025-03-15-python-uv/mnist-classifier/train.py" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">train.py</code></a>, and can be run with <code class="language-plaintext highlighter-rouge">uv run train.py</code>. It achieves a 98% classification accuracy on the held-out samples. Neat!</p> <p>Now that we have a working model, let’s see how <code class="language-plaintext highlighter-rouge">uv</code> helps us package the model into a Docker image.</p> <p>First, we need to pick our base image. Astral provides <a href="https://docs.astral.sh/uv/guides/integration/docker/#available-images" rel="external nofollow noopener" target="_blank">multiple pre-built images</a> that include <code class="language-plaintext highlighter-rouge">uv</code> and different versions of Python. Then, deploying the model is as easy as copying the model weights and the prediction script <a href="https://github.com/hclimente/hclimente.github.io/tree/main/assets/python/2025-03-15-python-uv/mnist-classifier/predict.py" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">predict.py</code></a> into the image, copying <code class="language-plaintext highlighter-rouge">uv</code> project environment files, and building the environment:</p> <div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> ghcr.io/astral-sh/uv:python3.10-bookworm-slim</span>

<span class="k">RUN </span><span class="nb">mkdir</span> <span class="nt">-p</span> /mnist_classifier/data
<span class="k">WORKDIR</span><span class="s"> /mnist_classifier</span>

<span class="c"># ensure uv.lock isn't modified</span>
<span class="k">ENV</span><span class="s"> UV_LOCKED=1</span>

<span class="c"># copy the minimum required files:</span>
<span class="c">## the uv files needed to recreate the environment</span>
<span class="k">COPY</span><span class="s"> pyproject.toml uv.lock ./</span>
<span class="c">## the prediction script</span>
<span class="k">COPY</span><span class="s"> predict.py .</span>
<span class="c">## the model weights</span>
<span class="k">COPY</span><span class="s"> data/mnist_cnn.pt data/</span>

<span class="c"># recreate the environment</span>
<span class="k">RUN </span>uv <span class="nb">sync</span> <span class="nt">--no-dev</span>

<span class="k">CMD</span><span class="s"> ["uv", "run", "predict.py"]</span>
</code></pre></div></div> <p>The key command here was <code class="language-plaintext highlighter-rouge">uv sync</code>, which will recreate the environment using the exact versions of the packages specified in <code class="language-plaintext highlighter-rouge">uv.lock</code>. This ensures that the environment used to train the model is identical to the one used to share it. Notice that the <code class="language-plaintext highlighter-rouge">--no-dev</code> flag will exclude the packages used for development, like <code class="language-plaintext highlighter-rouge">ipykernel</code>. It’s worth highlighting that the lockfile is cross-platform: I generated it on macOS, but the Docker image is based on Debian.</p> <blockquote> <p>Note: If you use GPU-specific packages, wheels may differ. See <a href="https://docs.astral.sh/uv/guides/integration/pytorch/#installing-pytorch" rel="external nofollow noopener" target="_blank">Astral’s docs</a>.</p> </blockquote> <p>Let’s now build and run the image:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> mnist_classifier <span class="nb">.</span>
docker run mnist_classifier
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SimpleCNN(
  (conv1): Conv2d(1, 32, kernel_size=(3, 3), stride=(1, 1))
  (conv2): Conv2d(32, 64, kernel_size=(3, 3), stride=(1, 1))
  (fc1): Linear(in_features=1600, out_features=128, bias=True)
  (fc2): Linear(in_features=128, out_features=10, bias=True)
)
Downloading MNIST test set...
Accuracy of SimpleCNN on the 10,000 test images: 98 %
</code></pre></div></div> <p>Nice!</p> <h1 id="conclusions">Conclusions</h1> <p>We have seen how <code class="language-plaintext highlighter-rouge">uv</code> can be used to manage Python projects, packages and environments. It satisfies my craving for reproducibility, is snappy and has simplified repetitive workflows. I look forward to seeing how it keeps evolving.</p> <h1 id="further-reading">Further reading</h1> <ul> <li><a href="https://www.bitecode.dev/p/a-year-of-uv-pros-cons-and-should" rel="external nofollow noopener" target="_blank">A year of uv: pros, cons, and should you migrate</a></li> </ul> </div> </article> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <br> <script defer src="/assets/js/giscus-setup.js"></script> <noscript> Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Héctor Climente-González. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>